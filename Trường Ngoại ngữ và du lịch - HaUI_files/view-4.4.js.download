/*vietlong.org 01/07/22 08:06:45*/
var dOneTask=function(){var t="deopsound",i={false:["false2.wav","oo.wav"],true:["true1.wav","true2.wav"],success:["success1.wav","success0.wav"],congratulations:{course_done:"victory.mp3",unit_done:"congratulations0.mp3"}};return{f8:{id:0,sec:"",start:""},f2:{},c0:"",a6:{},c1:{},a7:null,f3:{inittaskid:0,weekid:0,callbackUrl:"/study/task",isUnitTest:!1,unitdonelink:"",courselink:"",isMobile:!1,isTeacher:!1,isDeveloper:!1,languageid:0,soundon:!0,user:{id:0,display:"",avatar:"",studentid:0,classid:0}},f6:function(t){return 0===this.f3.weekid?"answer"===t?"#dViewAnswer":"submit"===t?"dSubmit":"":"#"+t+dj.sec(this.f3.user.id+"@"+this.f3.inittaskid+"."+this.f3.weekid).substring(3,11)},setLanguage:function(t){this.f3.languageid=t},e3:function(){var i=dj.cookie(t);dj.isNull(i)||(this.f3.soundon=1===dj.intval(i));var e=this,n=dj("#dsound");n.addClass(this.f3.soundon?"dsoundon":"dsoundoff").click((function(){return e.f3.soundon?n.removeClass("dsoundon").addClass("dsoundoff"):n.removeClass("dsoundoff").addClass("dsoundon"),e.f3.soundon=!e.f3.soundon,dWin.noise("Bạn <b>"+e.f3.user.display+"</b> đã <b>"+(e.f3.soundon?"bật":"tắt")+" âm thanh</b> hệ thống thành công!"),dj.cookie(t,e.f3.soundon?1:0),!1}))},b6:function(t){0===t.err?(dj("#dupload .fname").attr("rel",t.name).attr("href",t.src).html("<b>"+t.name+"</b> ("+t.filesize+"KB)"),dWin.noise("Upload tệp tin <b>"+t.filename+"</b> ("+t.filesize+"KB) thành công")):403===t.err?dDialog.alertError(djTemplate.render("Bài làm của bạn đã được <b>{score}</b> điểm. Bạn không thể gửi bài khác nữa.",t)):dDialog.alertError("Không thể gửi tệp tin <b>"+t.filename+"</b>")},c8:function(){var t=this;dj('#dupload input[name="fileattach"]').change((function(i){var e=i.target.value,n=i.currentTarget.files[0].size;if(""!==e){var a=e.toLowerCase().replace(/^.*\./,"");dj.inArray(a,["jpg","jpeg","docx","pptx"])>-1?n<=8388608?(document.domain=djConfig.HOST,dj(i.target).parents("form").attr("action","/study/uploadfile/b6?tid="+t.f8.id).submit()):dDialog.alertError("Tệp tin đính kèm vượt quá dung lượng 8MB cho phép"):dDialog.alertError("Không cho phép đính kèm tệp tin có định dạng "+a)}}))},d6:function(){var t=this;dj(".errchk input").iCheck({radioClass:"iradio_square-green"}),dj("#derrInfo .dsubmit").click((function(){return t.a2()}))},init:function(t){this.f3=dj.extend({},this.f3,t),this.f3.isMobile&&(this.f3.soundon=!1);var i=this;dj(document).ready((function(){i.d6(),i.c8(),i.e3(),dj("#duinfo img").attr("src",i.f3.user.avatar)}))},c3:function(t,i){void 0===i&&(i=this.f8.id);var e=this.f3.callbackUrl+"/"+t+"/"+this.f3.user.id+"/"+i;return djConfig.DEBUG&&(e+="?r="+Math.floor(1e3*Math.random())),e},e6:function(){dj("#mbody").html(this.c0)},a8:function(t,i){var e=this,n=dj("#daudioplayer").unbind("ended").on("ended",(function(){dj(".fa-pause").addClass("fa-play-circle").removeClass("fa-pause"),dj.isFunction(i)&&i()}));this.c1.done=[],dj(".daudio").click((function(){var t=dj(this),i=t.attr("media-url");dj(".fa-pause").addClass("fa-play-circle").removeClass("fa-pause"),t.hasClass("fa-play-circle")?(n.attr("src",i).html('<source src="'+i.replace(/.mp3/i,".ogg")+'" type="audio/ogg" />'),t.addClass("fa-pause").removeClass("fa-play-circle"),n[0].play()):(t.addClass("fa-play-circle").removeClass("fa-pause"),n[0].pause()),t.removeClass("fa-play-circle").addClass("fa-pause");var a=t.attr("rel");void 0!==a&&""!==a&&-1===dj.inArray(a,e.c1.done)&&e.c1.done.push(a)}))},e7:function(t){dj(".dvoca:first").addClass("active");var i=this;if(1===this.f8.view.write){function e(t){var n=t.parent().parent(),a=dj(".dview",n),s=dj("<li>"+t.html()+"</li>").click((function(){var i=dj(this),n=i.parent().parent(),a=dj("<li>"+t.html()+"</li>").click((function(){e(dj(this))}));dj(".dstore",n).append(a),i.remove()}));dj(s).insertBefore(dj("br",a)),t.remove();var d=a.text().toUpperCase(),r=dj(".dtitle",n),o=dj.sec(d).substr(0,20);if(r.val()===o)return i.e8(r,o)}dj(".sortable>li").click((function(){e(dj(this))}))}else dj("#dmcq .dtitle").click((function(){var t=dj(this);return i.e8(dj("span",t),t.attr("rel"))}));1===this.f8.view.audio&&(this.a8(t),setTimeout((function(){dj("#dmcq .daudio:first").click()}),1e3)),t&&t.center()},b7:function(t){if(void 0!==t.answers)if(1===this.f8.view.fill){var i=t.answers;dj("#dquestion input.danw").each((function(){dj(this).val(i.shift())}))}else if(1===this.f8.view.choose){var e=t.answers;for(var n in e)dj("#dquestion input[value='"+e[n]+"']").iCheck("check")}1===this.f8.view.choose?(dj("#dquestion input[type='checkbox']").iCheck({checkboxClass:"icheckbox_square-green"}),dj("#dquestion input[type='radio']").iCheck({radioClass:"iradio_square-green"})):1===this.f8.view.fill&&dj.inArray(this.f3.languageid,[2,3,4])>-1&&dj("#dquestion input.danw").each((function(){var t=dj(this);t.attr("size",2*dj.intval(t.attr("size")))}))},d7:function(t,i){if(void 0===t)return!1;var e='<source src="'+t.replace(/.mp3/i,".ogg")+'" type="audio/ogg" />';try{dj("#daudioplayer").unbind("ended").on("ended",(function(){dj.isFunction(i)&&i()})).attr("src",t).html(e).unbind("error").on("error",(function(){dj.isFunction(i)&&i()}))[0].play()}catch(t){djLog(t)}return!1},e9:function(t){return djConfig.MEDIA_URL+"rs/"+t},playSoundCdn:function(t,i){if(!this.f3.soundon)return dj.isFunction(i)&&i(),!1;var e=this.e9(t);return this.d7(e,i)},a9:function(t,i){var e=dj(".q"+t+" .daudio:first").attr("media-url");return this.d7(e,i)},e8:function(t,i){var e=this,n=dj.intval(t.attr("aid"));return this.d8(t,i,n,(function(t){var i=".q"+t,n=".q"+(t+1);1===e.f8.view.audio?(dj(i).removeClass("active"),dj(n).addClass("active"),setTimeout((function(){dj(n+" .daudio:first").click()}),500)):e.a9(t,(function(){setTimeout((function(){dj(i).removeClass("active"),dj(n).addClass("active")}),200)}))}))},d8:function(t,e,n,a){var s=t.attr("rel"),d=dj("#qid"+s).attr("rel").split("-"),r=dj.intval(d[0]);if(dj(".q"+r).hasClass("active")){var o=!1;if(1===this.f8.view.write)o=!0;else{var c=dj.intval(dj.oEncrypt2(d[1]));o=n-1==dj.intval(dj.oEncrypt2(d[2]))-c-dj.intval(s)}if(o)void 0!==e&&""!==e&&-1===dj.inArray(e,this.c1.done)&&this.c1.done.push(e),this.b1(),a(r);else{var u=Math.floor(Math.random()*i.false.length);this.playSoundCdn(i.false[u]),t.parent().parent().css({border:"dotted 1px RED"})}}return!1},b1:function(){var t=this.c1.done.length===this.c1.total;if(t){var i=this,e=this.d1();this.e6(),e.vocabularys=this.c1.done.join(","),dj.postJSON(this.c3("result"),e,(function(t){if(0===t.err)return i.d2(t.data);dDialog.alertError(t.msg)}))}return t},d3:function(t){return this.c3("api",t)},d9:function(t,i){return 1===this.f3.languageid?dj.rsa.decrypt(t,i):t},developerNextTask:function(){var t=this;return dDialog.confirm("Bạn chắc chắn muốn qua bài?",(function(){dj.postJSON(t.c3("devnext"),t.d1(),(function(i){if(0===i.err)return t.d2(i.data);dWin.alert("Có lỗi, không thể qua bài.")}))})),!1},b3:function(t){var i="degroup_"+t,e=dj.cookie(i);return dj.isNull(e)},c6:function(t,i){if(0!==i.err)return dWin.alert(i.msg),!1;var e=i.data;1===this.f3.languageid&&(e=dj.rsa.decrypt(i.data,i.publickey));var n=e.split("||");if(1===this.f8.view.fill)for(var a in n){var s=dj.oEncrypt2(n[a]);dj("#dquestion .danw:eq("+a+")").attr("placeholder",s).val(s).css({color:"GREEN"})}else if(1===this.f8.view.choose)for(var a in dj("#dquestion .dchk .deck").iCheck("uncheck"),n){var d=n[a];dj("#dquestion .dchk #chk_"+d).iCheck("check")}return t.html('<i class="fa fa-undo"></i>&nbsp;Làm lại').removeClass("btn-danger").addClass("btn-primary"),this.f2.showAnswering=!0,!1},e1:function(t,i){var e=this,n={languageid:this.f3.languageid,qsortkey:this.f2.qsortkey,captcha:i};dj.postJSON(this.c3("answer"),dj.extend({},e.d1(),n),(function(i){if(911!==i.err)return e.a6[e.f8.id]=i,e.c6(t,i);e.a3(i,(function(i){e.e1(t,i)}))}))},a1:function(){null===this.b8&&(this.b8=dj(this.f6("submit")));var t=this,i=dj(this.f6("answer")).click((function(){if(t.f2.showAnswering)t.f2.showAnswering=!1,t.b8.show(),i.html('<i class="fa fa-eye"></i>&nbsp;Xem lại đáp án').removeClass("btn-primary").addClass("btn-danger"),1===t.f8.view.fill?dj("#dquestion .danw").val("").css({color:"RED"}):1===t.f8.view.choose&&(dj("#dquestion .dchk .deck").iCheck("uncheck"),dj("#dquestion .dchk .dred").removeClass("dred"));else{if(t.d4()-t.f2.timenow<t.f8.seconds)return dWin.alert("Phải suy nghĩ ít nhất "+t.f8.seconds+" giây mới có thể xem đáp án."),!1;if(t.b8.hide(),t.f2.btn_answer+=1,void 0!==t.a6[t.f8.id])return t.c6(i,t.a6[t.f8.id]);t.e1(i,"")}}));return i},b8:null,a2:function(){var t=window.screen,i=this,e=dj("#derrInfo textarea"),n=e.val();if(""===n)return dWin.alert("Bạn cần nhập nội dung ý kiến đóng góp cho hệ thống"),!1;var a=0;if(dj("#derrInfo .errchk input").each((function(){var t=dj(this);t.iCheck("update")[0].checked&&(a=dj.intval(t.val()))})),0===a)return dWin.alert("Bạn góp ý cho vấn đề gì?"),!1;var s=this.f8.id,d=this.d4(),r=djson.encode({languageid:this.f3.languageid,studentid:this.f3.user.studentid,classid:this.f3.user.classid,timeclient:d,errtpy:a,errmsg:n,sw:t.width,sh:t.height}),o=dj.rsa.encrypt(r);return e.val(""),dj.postJSON(this.c3("report",s),{taskid:this.f8.sec,timeclient:d,data:o,seck:dj.sec(o)},(function(t){dj("#derrInfo").modal("hide"),0===t.err?dWin.noise(djTemplate.render("Đã ghi nhận ý kiến của <b>{display}</b>!",i.f3.user)):dWin.alert("Không thể báo lỗi. "+t.msg)})),!1},a3:function(t,i){var e=this,n=t.length,a=null,s='<div class="dgcaptcha"><input id="txtcaptcha" type="text" maxLength="'+n+'" placeholder="Nhập theo ảnh"/></div>';dDialog.openContent(s,"Tôi không phải Robot",{modal:!0,unloadOnHide:!0,afterShow:function(i){a=dCaptcha.init("txtcaptcha",150,50,n,t.token),i.moveTo(100),i.center()}},{btnSubmit:{cls:"L3",title:"Tiếp tục",command:function(){var t=dj("#txtcaptcha").val(),s=dj("#hdtxtcaptcha").val();return""!==t&&""!==s&&t.length===n?(i(n.toString()+e.f8.id.toString()+t.toString()+s),!0):(a.refresh(),!1)}}})},a0:function(t,i){if(911===t.err){var e=this;this.a3(t,(function(t){var n=dj.extend({captcha:t},e.a7);dj.postJSON(i,n,(function(t){e.a0(t,i)}))}))}else 0===t.err?this.b2(t):dWin.alert("Có lỗi, không thể gửi dữ liệu bài học, bạn vui lòng làm lại bài tập (2)!");return!1},b2:function(t){this.f2.btn_submit+=1;var i=this,e=t.data,n="Đã gửi kết quả lên máy chủ";if(this.f3.isUnitTest)dWin.noise(n,2e3,{action:"success",callback:function(){return i.d2(e)}});else{if(e.result=Math.round(100*e.result),1===this.f8.view.choose)n=djTemplate.render("Bạn đã hoàn thành <b>{result}</b>% yêu cầu của <b>{total_question}</b> câu hỏi, chưa thể vượt qua bài học.",e),e.done&&(n=djTemplate.render("Bạn đã đánh dấu đúng toàn bộ <b>{total_question}</b> câu hỏi!",e)),dj("#dquestion .dchk label").css({color:"BLACK"}),dj("#dquestion .deck").each((function(){var t=dj(this);if(t.iCheck("update")[0].checked){var i=t.attr("id"),n=t.val(),a=dj.inArray(n,e.true_idx)>-1;dj("#dquestion .dchk label[for='"+i+"']").css({color:a?"GREEN":"RED"})}}));else if(1===this.f8.view.fill)for(var a in n=djTemplate.render("Bạn đã điền đúng <b>{total_answerok}</b> / <b>{total_fill}</b> ô trống đáp án (đạt {result}% yêu cầu).",e),e.done&&(n=djTemplate.render("Bạn đã điền đúng toàn bộ đáp án!",e)),e.true_idx){var s=e.true_idx[a];dj("#dquestion .danw:eq("+s+")").css({color:"GREEN"})}dWin.noise(n,1500,{action:e.done?"success":"error",callback:function(){if(e.done)return i.d2(t.data);i.f2.btn_submit>=1&&(1===i.f2.btn_submit&&dWin.noise('Có thể tham khảo Đáp án bằng cách Click vào "Xem đáp án"',2e3,{positionClass:"toast-bottom-right"}),dj(i.f6("answer")).show())}})}},b9:function(){var t=this;setTimeout((function(){t.b8.removeAttr("disabled")}),2e3)},c7:function(t,i){if(0===t.err){this.f8=t.task;var e=t.key.public,n=t.key.private,a=t.task.title+"<i> - "+t.task.source+"</i>";void 0!==i&&(a+=" ("+i.done+" / "+i.total+")"),dj("#dtasktitle").html(a);var s={source:this.f8.source,showid:this.f8.showid,body:this.d9(t.data.view,e)},d=djTemplate.render('<div class="d{source} {showid}">{body}</div>',s);dj("#mbody").html(d);var r=dj("#mbody").width(),o=!0,c=!0,u=30;if(this.f3.isUnitTest&&(o=!1,c=!1,u=10),dmediaEmbed({width:r,scale:0,isAd:!1,hls:!0,audio:{allowSeek:o,allowPause:c,maxPlay:u,onPlay:function(t){dj.isFunction(t)&&t()},onPause:function(t){dj.isFunction(t)&&t()},onMaxPlayed:function(){dWin.alert("Đã nghe quá số lần quy định ("+u+" lần).")}}}),this.f3.isUnitTest&&(dj("#mfooter .btpn").hide(),void 0!==this.f8.backward&&dj("#test_backward").attr("href",this.f8.backward).show(),void 0!==this.f8.forward&&dj("#test_forward").attr("href",this.f8.forward).show()),dj("#mbody a").each((function(){dj(this).attr("target","_blank")})),dj("#mbody img").each((function(){var t=dj(this);t.attr("src");setTimeout((function(){t.css({border:"solid 1px #FEFEFE"})}),1e3)})),dj(".dnut").hide().unbind("click"),"upload-content"===this.f8.showid){if(t.task.user_attach){var l=dj("#dupload textarea");if(l.val(t.task.user_attach.m),dj("#dupload .fname").html(t.task.user_attach.f).attr("rel",t.task.user_attach.f).attr("href",t.task.user_attach.src),dj("#dupload .stime").attr("rel",t.task.user_attach.t),t.task.user_attach.disabled){l.attr("disabled",!0);var h=t.task.user_attach.score;dj("#dupload .dnote").html(djTemplate.render('<b>Phản hồi của giảng viên</b>:<b class="sc">{s}</b> điểm.<p>{c}</p>',h)).show()}dWidget.time()}else dj("#dupload textarea").val(""),dj("#dupload .fname").html("").attr("rel","").attr("href",""),dj("#dupload .stime").attr("rel",0),dj("#dupload .dnote").html("").hide();dj("#dupload").show()}else dj("#dupload").hide();var f=this,p=this.c3("result");if("vocabulary"===this.f8.source)this.c1.total=t.data.total,this.a8(),this.b8=dj(this.f6("submit")).click((function(){return f.b8.attr("disabled",!0),f.b1()||dWin.alert("Bạn cần click đọc tất cả các từ mới để học và chuyển bài tiếp theo"),f.b9(),!1})),setTimeout((function(){f.b8.show()}),2e3);else if("mcq"===this.f8.source)this.c1.total=t.data.total,this.e7();else if("content"===this.f8.source)this.b8=dj(this.f6("submit")).click((function(){f.b8.attr("disabled",!0);var t=f.d1();"upload-content"===f.f8.showid&&dj.extend(t,{attach_msg:dj("#dupload textarea").val(),attach_file:dj("#dupload .fname").attr("rel")}),dj.postJSON(p,t,(function(t){return f.b9(),0===t.err?dWin.noise("Đã hoàn thành bài đọc...",2e3,{action:"success",callback:function(){return f.d2(t.data)}}):dWin.alert("Có lỗi, không thể gửi dữ liệu bài học, vui lòng xem lại bài học!"),!1}))})),setTimeout((function(){f.b8.show()}),2e3);else if("question"===this.f8.source){var v=t.data.total;if(this.b7(t),this.f2.showAnswering=!1,this.f2.qsortkey=t.data.qsortkey,this.b8=dj(this.f6("submit")).click((function(){if(f.b8.attr("disabled",!0),f.f2.showAnswering)return f.b9(),!1;var t=null;if(1===f.f8.view.choose){var i=[];if(dj("#dquestion .deck").each((function(){var t=dj(this);t.iCheck("update")[0].checked&&i.push(t.val())})),!f.f3.isUnitTest&&i.length<v)return dWin.alert("Bạn cần đánh dấu vào các lựa chọn cho câu trả lời trước khi gửi kết quả."),f.b9(),!1;t=djson.encode({ua:i})}else if(1===f.f8.view.fill){var a=[],s=!1,d=[];if(dj("#dquestion .danw").each((function(){var t=dj(this).val();a.push(t),""!==t&&(s=!0,d.push(t))})),!f.f3.isUnitTest&&(!s||d.length<a.length))return dWin.alert("Bạn cần điền nội dung câu trả lời vào các ô trống trước khi gửi kết quả."),f.b9(),!1;t=djson.encode({ua:a})}if(null!==t){var r=t;1===f.f3.languageid&&(r=dj.rsa.encrypt(t,e)),f.a7=dj.extend({},f.d1(),{publickey:e,clientkey:n,qsortkey:f.f2.qsortkey,answer:r}),dj.postJSON(p,f.a7,(function(t){return f.b9(),f.a0(t,p)}))}})),setTimeout((function(){f.b8.show()}),1500),!this.f3.isUnitTest){var j=this.a1();(this.f3.isTeacher||this.f3.isDeveloper)&&j.show()}}setTimeout((function(){dj("#dReport").show()}),5e3)}else dWin.alert("Có lỗi: "+t.msg)},e5:function(t,i){this.f2={timenow:this.d4(),btn_submit:0,btn_answer:0},this.c1={total:0,done:[]},this.c7(t,i)},oneTask:function(t,i,e){if(void 0!==e&&this.b3(e))return dWin.alert("Bạn cần chọn lại lớp độc lập để bắt đầu thực hành các bài học"),!1;this.f8.sec=i,this.c0=dj("#mbody").html(),this.e6();var n=this;return dj.postJSON(this.d3(t),this.d1(),(function(t){n.e5(t)})),!1},d4:function(){return Math.round((new Date).getTime()/1e3)},d1:function(t){return dj.extend({},{taskid:this.f8.sec,languageid:this.f3.languageid,taskstart:this.f8.start,timeclient:this.d4()},this.f2,t)},d2:function(t){var e=this,n=dj("#dunittitle").text();if(t.unit_done)if(e.f3.isUnitTest){var a=djTemplate.render('<div style="max-width:350px"><h5><b>{display}</b> đã hòan thành xong các bài của <b>{unit_name}</b>!</h5><p>Còn thời gian nên bạn có thể làm lại, hệ thống ghi nhận kết quả cuối cùng.</p><p style="text-align:center;margin:10px auto"><img src="{img}" style="width:200px;height:auto;max-height:180px"/></p></div>',{unit_name:n,display:this.f3.user.display,img:this.e9("unittest_done.jpg")});dDialog.openContent(a,"Thông báo",{modal:!0,afterShow:function(t){dj(document).ready((function(){t.moveTo(100),t.center()}))}},{btnSubmit:{cls:"L3",title:"Nộp bài",command:function(){window.location.href=e.f3.unitdonelink}},btnCancel:{cls:"L4",title:"Làm tiếp"}})}else{var s=djTemplate.render("Chúc mừng {display} đã học xong bài {unittitle}.",{display:this.f3.user.display,unittitle:n});dWin.alert(s),this.playSoundCdn(i.congratulations.unit_done,(function(){setTimeout((function(){window.location.href=e.f3.courselink}),2e3)}))}else if(t.next){if(e.f3.isUnitTest)e.e5(t.next,t.userlog);else{var d=Math.floor(Math.random()*i.success.length),r=i.success[d];this.playSoundCdn(r,(function(){e.e5(t.next,t.userlog)}))}history.replaceState({},"",t.next.task.id+"?id="+t.next.task.sec)}return!1}}}();